# 実装タスクリスト

## セクション1：データモデル実装
- [x] 1.1 スナップ設定の状態とユーティリティ関数を追加する
  - design.md の SnapSettings 設計に従い、`App.tsx` に `snapSize` state を追加
  - `snapToGrid(value: number, snapSize: number)` の純粋関数を `src/utils/snap.ts` として実装
- [x] 1.2 既存モデルとの整合性を確認する
  - Block / Marker / Note の座標更新でスナップ値が適用されることを確認
  - JSON 保存フォーマットに変更が不要であることを確認

## セクション2：ビジネスロジック実装
- [x] 2.1 スナップ切替処理を実装する
  - `App.tsx` に 150mm ↔ 300mm を切り替えるハンドラを追加
  - `ToolPalette` からのイベントで `snapSize` が更新されることを確認
- [x] 2.2 グリッド描画とドラッグ処理にスナップを反映する
  - `CanvasArea` のグリッド描画ロジックを拡張し、150mm/300mm 表示を切替
  - ブロックドラッグ終了、メモ配置などの座標更新時に `snapToGrid` を適用
- [x] 2.3 エラーハンドリングを組み込む
  - 不正なスナップ値はそのままスルーし、コンソール警告を出す
  - Konva イベントで座標が取得できない場合のガードを追加

## セクション3：インターフェース実装
- [x] 3.1 スナップトグル UI を追加する
  - `ToolPalette` にスナップ単位表示・切替ボタンを追加し、スタイルを整える
- [x] 3.2 ステータスバー表示を更新する
  - 現在のスナップ単位を StatusBar もしくはヘッダー付近に表示（必要に応じて）
- [x] 3.3 ブロック詳細表示をスナップ値と整合させる
  - `BlockListPanel` などで座標表示があれば、スナップ適用後の値が表示されるよう確認

## セクション4：統合とテスト
- [x] 4.1 コンポーネントを統合する
  - `App.tsx` で新しい props を配線し、全体のデータフローが一貫することを確認
- [x] 4.2 動作確認テストを実施する
  - `npm run dev` で手動操作し、切替・ドラッグ・保存が問題なく行えるか確認
  - 可能であれば unit テストで `snapToGrid` の挙動を検証
  - 備考: サンドボックス環境の制約で開発サーバーは起動できず（EPERM）、`npm run test`・`npm run build` で回帰確認を実施
- [x] 4.3 受入基準を満たすことを確認する
  - 要件定義書の各受入チェック項目を目視・動作で満たすことを確認
