# Line Dimension Popup Tasks

| Priority | タスク名 | 目的・定義 | 対象ファイル | DoD | 担当 |
| --- | --- | --- | --- | --- | --- |
| P0 | ラインデータモデル整備 | `App` に `ScaffoldLine[]` と選択状態 (`activeLineId`) を追加し、既存ブロックからラインを生成する下地を用意する | `src/App.tsx`, `src/types.ts` | ライン配列の初期値がセットされ、状態変更で再描画が破綻しない | 未割当 |
| P0 | Canvasライン選択対応 | `CanvasArea` で `ScaffoldLine` を Konva `Line` として描画し、クリックで `onSelectLine` を通知。選択時ハイライトを適用 | `src/components/CanvasArea.tsx` | クリックすると指定ラインIDが返り、ハイライトが即時反映される | 未割当 |
| P0 | ポップアップUI実装 | オーバーレイ型 `LineLengthPopup` コンポーネントを新設し、自動フォーカス・Enter/Escape 操作・バリデーションを実装 | `src/components/LineLengthPopup.tsx`, `src/App.tsx`, `src/App.css` | UI が表示され操作でき、無効値を拒否する | 未割当 |
| P0 | 長さ更新ロジック | `handleLineLengthChange` を実装し、ユニットベクトル＋スナップで新座標計算、ライン状態と依存ラベルを更新 | `src/App.tsx`, `src/utils/*` | 正常入力でライン長が更新され、スナップ後もミッドポイントが維持される | 未割当 |
| P1 | バリデーションとメッセージ | 正数のみ許可し、空/0/負数/非数でエラー表示。`aria-live` で読み上げ対応 | `src/components/LineLengthPopup.tsx` | エラー時に送信不可で、スクリーンリーダーで確認できる | 未割当 |
| P1 | テスト整備 | 長さ再計算ヘルパーのユニットテスト、ポップアップのコンポーネントテスト、クリック→確定までの統合テスト | `tests/*` | 主要シナリオの自動テストがグリーンで実行される | 未割当 |
| P1 | ドキュメント/エクスポート確認 | 更新されたライン長が JSON/PNG/PDF 出力へ反映されるか確認し、必要なら更新。変更点を README 等へ追記 | `src/App.tsx`, `docs/*`, `tests/*` | エクスポートしたデータ/画像に修正が反映され、記述が最新化される | 未割当 |
| P2 | アクセシビリティ最終確認 | axe-core などでポップアップの a11y をチェック、必要に応じてラベルや属性調整 | `src/components/LineLengthPopup.tsx`, `tests/accessibility/*` | a11y チェックがパスし、修正が必要なら反映済み | 未割当 |
| P2 | 追加仕様調整 (未確定事項) | ミッドポイント固定の確定、リアルタイムプレビューや長さ制限など要確認事項の対応 | TBD | 決定事項を反映するコミット or チケットを用意 | 未割当 |

## 依存関係 & 並行性
- `ラインデータモデル整備` が最初の依存。これが完了すれば `Canvasライン選択対応` と `ポップアップUI実装` を並行可能。
- `長さ更新ロジック` は UI が呼び出すため、ポップアップ実装と連携して進める。
- テスト整備・a11y 確認は主要機能が動いた後で実施。

## ブロッカー
- データモデルをどの既存構造から生成するか（ブロック由来か独立か）で調整が必要。
- リアルタイムプレビューなど未確定仕様は P2 として別途判断。

設計参照: `.sdd/specs/line-dimension-popup/design.md`
