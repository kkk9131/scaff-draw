# ScaffDraw 要件定義書

## 1. 目的
- 手描きの足場平面図を、より高速かつ正確なデジタル作図フローに置き換える。
- 作図時間を短縮し、現場業務および SCAFF プラットフォーム開発に充てられる時間を増やす。
- 作図データを将来の SCAFF 本番システム（Konva ベース）で再利用できる JSON 形式で保存し、ワークフロー統合を見据える。

## 2. 対象ユーザー
- 開発者本人のみが利用するローカル専用アプリ。
- 現場準備や検証業務を効率化するための個人ユースを想定。

## 3. 開発環境
- **動作環境**: インターネット不要のローカルブラウザアプリ。
- **利用技術**:
  - React + Vite：UI フレームワーク。
  - Konva.js：キャンバス描画エンジン。
  - FileSaver.js：JSON／PNG のエクスポート。
  - jsPDF：PDF 生成。
  - TailwindCSS（任意）：UI スタイリング。

## 4. 機能要件

### 4.1 作図ワークスペース
- 300 mm 基準のグリッドを背景に表示する。
- ドラッグ操作で足場平面の直線を描けるようにする。
- 「割付」操作を用意し、以下を自動化する：
  - スパンを 1,800 mm 単位で自動分割。
  - 余りは 1,500／1,200／900／600 mm の順で割り当てる。
  - 各スパンをブロック表示し、ブロック間に柱マーカーを自動配置する。
- 直線描画モードではドラッグ／2クリックの両操作をサポートし、スナップ付きプレビューで終点を確認しながら確定できる。色（黒／赤／青／緑）と線種（実線／点線）の切替に対応する。

### 4.2 ブロック編集
- ドラッグ＆ドロップでブロックの削除や位置入れ替えを行える。
- ブロック分割（例：1,800 mm → 900 mm + 900 mm）に対応する。
- 階段・梁枠などの特殊部材を追加できる。
- 各ブロックに部材種別タグを保持させる。

### 4.3 メモ機能
- 柱マーカーに「支柱組み合わせメモ」を紐付け、カーソルホバー時に吹き出し表示する。
- 任意位置に自由配置可能なテキストメモを設置できるようにする。

### 4.4 保存・出力
- JSON 保存：`scaffold_YYYYMMDD.json` 形式でエクスポート。
- PNG 保存：`scaffold_YYYYMMDD.png` 形式でエクスポート。
- PDF 保存：`scaffold_YYYYMMDD.pdf` 形式で生成。
- 保存済み JSON を読み込んで再編集できるようにする。

## 5. 非機能要件
- **利用環境**: 完全ローカル動作（ネット接続不要）。
- **コスト**: 利用ライブラリはすべて無料（MIT 系ライセンス）。
- **レスポンス**: 紙よりも直感的で素早い操作感。
- **データ互換性**: SCAFF 本番システム（Konva ベース）の JSON 形式と互換性を保持する。

## 6. フェーズ分割
- **Phase 1（MVP）**
  - グリッド描画。
  - 直線描画 → 割付 → ブロック化。
  - 柱マーカー自動配置。
  - JSON／PNG／PDF 出力。
- **Phase 2（機能拡張）**
  - ブロック編集（D&D 削除／入替／分割）。
  - 特殊部材（階段・梁枠など）の追加。
  - メモ吹き出し機能。
- **Phase 3（将来の SCAFF 連携）**
  - 各ブロックに部材 ID を付与。
  - 柱マーカーに支柱構成データを付与。
  - SCAFF API とデータ連携。

## 7. 想定メリット
- 紙より短時間で作図でき、日常業務の効率が向上する。
- JSON 形式で保存することで、SCAFF のテストデータとして再利用できる。
- 将来の本番統合を見据えた開発となり、無駄が生じない。

## 8. MVP UI レイアウト案
```
---------------------------------------------------
| ヘッダーバー                                     |
| [新規作図] [保存(JSON)] [保存(PNG)] [保存(PDF)] |
---------------------------------------------------
| 左サイドバー             |     メインキャンバス      | 右サイドバー        |
|--------------------------|--------------------------|---------------------|
| [直線描画モード]         |   ┌──────────────────┐   | ブロックリスト       |
| [割付ボタン]             |   │   グリッド(300mm) │   | ──────────────── |
| [柱マーカー追加]         |   │   足場ブロック配置 │   | Span #1: 1800mm   |
| [特殊部材: 階段]         |   │   柱マーカー        │   | Span #2: 1800mm   |
| [特殊部材: 梁枠]         |   │   テキストメモ      │   | Span #3: 1200mm   |
| [テキストメモ]           |   └──────────────────┘   | ...                |
|--------------------------|                          |                     |
| [削除] [分割] [入替]     | ←ドラッグ&ドロップ可能    | 選択中ブロック情報  |
---------------------------------------------------
| ステータスバー：マウス座標 (x, y) ／ スパン合計長   |
---------------------------------------------------
```

### 8.1 ヘッダーバー
- 保存系（JSON／PNG／PDF）ボタンを常時表示し、ワンクリックでエクスポート可能。
- 「新規作図」ボタンはキャンバス状態と内部データを初期化する。

### 8.2 左サイドバー（ツールパレット）
- 直線描画モードで外形をドラッグして入力。
- 割付ボタンでスパンの自動分割処理を実行。
- 柱マーカー、特殊部材（階段・梁枠）、テキストメモを追加できる。

### 8.3 メインキャンバス
- 300 mm 単位のグリッドを表示し、ズーム時もスケール感を維持する。
- 足場ブロックを配置・編集でき、ドラッグ＆ドロップで位置調整や改変が可能。
- 柱マーカーにカーソルを合わせると支柱組み合わせメモを吹き出し表示する。

### 8.4 右サイドバー
- スパン順序を確認できるブロックリストを表示する。
- 削除／分割／入替といったブロック編集操作を提供する。
- 選択中ブロックの詳細（長さ、部材タグなど）を編集できるフォームを配置する。

### 8.5 ステータスバー
- 現在のマウス座標を mm 単位でリアルタイム表示し、正確な位置決めを支援する。
- キャンバス上のスパン合計長を表示し、誤差チェックに利用できる。
